# motor-controller
A motor controller firmware developed with a STM32 MCU
## System Architecture 
![System Architecture](https://github.com/user-attachments/assets/416b318d-2818-4d5c-865c-c8d325d4e588)

## Main components 
**Running Status struct:** A data structure defined to hold the real time parameters of the system providing a single point of access for write and read.
	- Reference Speed: The speed required by the user – updated by user input (INC/DEC)
	- Current RPM: The current rpm calculated by the Timer using motor controller feedback 
	- PID Output: The output generated by the closed loop PID controller output
	- Fault Status: The True (1) / False (0) flag defined to indicate any fault conditions in the motor
**Timer with RPM Calculator:** A timer set to overflow at a sampling period of 600 ms (equivalent to 10 pulses at 100 RPM) with input capture configured to count the number of pulses that resets each time the timer interrupt is triggered. The count of pulses is used to calculate the current RPM and update in the Running status struct.
**PID Controller:** A closed loop PID controller that uses the reference speed, feedback motor speed and the tuned K_p,K_i  and K_d values to reduce the error.
error [i] = reference speed [i] - current RPM [i-1]
PID Output = [PID Controller gains] ← error
**PWM Generator:** Another timer is used to generate the PWM signal of 100 Hz frequency by varying the duty cycle according to the PID output. In case of a fault condition, the PID output is bypassed and the control signal is set to stop the motor.
**SR Control:** Shift Register control logic to control the LED Array. Two cascaded shift registers of 8 outputs each is configured to switch on required number of LEDs according to the current RPM out of the 10 LEDs by setting their register value High.

![Shift Register Setup](https://github.com/user-attachments/assets/a2ee83d4-e966-4436-a987-0404ba86100f)
_Shift Register Setup for LED Array_

